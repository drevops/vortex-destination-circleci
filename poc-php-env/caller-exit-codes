#!/usr/bin/env php
<?php

echo "CALLER: Setting MY_VAR=hello\n\n";
putenv('MY_VAR=hello');

// Call success script
echo "CALLER: Calling ./callee-success\n";
$exit_code = 0;
passthru('./callee-success', $exit_code);
echo "CALLER: Exit code = $exit_code\n\n";

// Call fail script
echo "CALLER: Calling ./callee-fail\n";
$exit_code = 0;
passthru('./callee-fail', $exit_code);
echo "CALLER: Exit code = $exit_code\n\n";

// Demonstrate stopping on failure
echo "CALLER: Now with failure handling...\n\n";

echo "CALLER: Calling ./callee-success\n";
passthru('./callee-success', $exit_code);
if ($exit_code !== 0) {
  echo "CALLER: Failed! Stopping.\n";
  exit($exit_code);
}
echo "CALLER: Success, continuing...\n\n";

echo "CALLER: Calling ./callee-fail\n";
passthru('./callee-fail', $exit_code);
if ($exit_code !== 0) {
  echo "CALLER: Failed! Stopping.\n";
  exit($exit_code);
}
echo "CALLER: Success, continuing...\n";
