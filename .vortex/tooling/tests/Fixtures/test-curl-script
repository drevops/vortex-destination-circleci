#!/usr/bin/env php
<?php

/**
 * @file
 * Test fixture script for curl operations.
 *
 * This is a pure test fixture without helpers - used to test the testing infrastructure itself.
 */

declare(strict_types=1);

namespace DrevOps\VortexTooling;

require_once __DIR__ . '/../../src/helpers.php';

echo '[INFO] Starting test curl script.' . PHP_EOL;

// Get URL from environment variable.
$url = getenv('TEST_CURL_URL') ?: 'https://example.com';

echo sprintf('[INFO] Making request to: %s', $url) . PHP_EOL;

// Make curl request.
$response = curl_request($url);

// Output response details.
if ($response['ok']) {
  echo '[ OK ] Request successful.' . PHP_EOL;
  echo sprintf('       Status: %d', $response['status']) . PHP_EOL;
  echo sprintf('       Body length: %d bytes', strlen((string) $response['body'])) . PHP_EOL;
}
else {
  echo sprintf('[FAIL] Request failed: %s', $response['error'] ?? 'HTTP ' . $response['status']) . PHP_EOL;
  exit(1);
}

echo '[ OK ] Finished test curl script.' . PHP_EOL;
